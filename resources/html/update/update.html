<head>
    <link rel="stylesheet" href="{{_res_path}}html/update/update.css">
</head>

<body style="scale: {{size}};">
    <div class="background">
        {{if background}}
        <img src="{{background}}" alt="曲绘-模糊">
        {{else}}
        <img src="{{_res_path}}html/otherimg/phigros.png" alt="曲绘-模糊">
        {{/if}}
    </div>
    <div class="title">
        <div class="l">
            <img src="{{_res_path}}html/otherimg/Phigros_Icon_3.0.0.png" alt="icon">
            <div class="doc">
                <p>{{update_ans}}</p>
                <p>Update 结果</p>
            </div>
        </div>
        <div class="m"></div>
        <div class="r">
            <p>Player: {{PlayerId}}</p>
            <p>RankingScore: {{Rks}}</p>
            <div class="Challenge">
                <p>ChallengeMode:</p>
                {{if dan}}
                <div class="CLG {{dan.EX ? 'colorful' : ''}}">
                    <p>{{dan.Dan}}</p>
                </div>
                {{/if}}
                <div class="Challenge-r">
                    <img src="{{_res_path}}html/otherimg/{{ChallengeMode}}.png" alt="Challenge">
                    <p>{{ChallengeModeRank}}</p>
                </div>
            </div>
            <p>Notes: {{Notes}}</p>
            <p>Date: {{Date}}</p>
        </div>
    </div>
    {{if box_line[0]||task_data}}
    <div class="record_box">
        {{if task_data}}
        <div class="title_box">
            <div class="box_title" style="width: 1730px;filter: drop-shadow(0px 2px 2px #fff382);">
                <div class="box_title-right-down" style="background-color: #fff382;"></div>
                <div class="box_title-left" style="background-color: #fff382;">
                    <p style="color: white;text-shadow: 0px 0px 14px #000000;">Task_table</p>
                </div>
                <div class="box_title-right">
                    <p>{{task_time}}</p>
                </div>
            </div>
        </div>
        <div class="song_box">
            {{each task_data song}}
            {{if song}}
            <div class="abox">
                <div class="imgbox">
                    <img src="{{song.illustration}}" alt="{{song.song}}">
                </div>
                {{if song.finished}}
                <div class="coinbox">
                    <p>+{{song.reward}} Notes</p>
                </div>
                {{else}}
                <div class="coinbox_un">
                    <p>+{{song.reward}} Notes</p>
                </div>
                {{/if}}

                <div class="infobox">
                    {{if song.finished}}
                    <div class="namebox_ed">
                        <div class="songsname">
                            <p name="pvis">{{song.song}}</p>
                        </div>
                    </div>
                    {{else}}
                    <div class="namebox_un">
                        <div class="songsname">
                            <p name="pvis">{{song.song}}</p>
                        </div>
                    </div>
                    {{/if}}
                    {{if song.finished}}
                    <div class="songsinfo_ed">
                        <div class="rank">
                            <p>{{song.request.rank}}</p>
                        </div>
                        <div class="score">
                            <p>{{song.request.value}}</p>
                        </div>
                    </div>
                    {{else}}
                    <div class="songsinfo_un">
                        <div class="rank">
                            <p>{{song.request.rank}}</p>
                        </div>
                        <div class="score">
                            <p>{{song.request.value}}</p>
                        </div>
                    </div>
                    {{/if}}
                </div>
            </div>
            {{/if}}
            {{/each}}
        </div>
        {{/if}}


        {{each box_line time_line}}
        <div class="title_box">
            {{each time_line date}}
            <div class="box_title" style="width: {{date.width}}px;filter: drop-shadow(0px 2px 2px {{date.color}});">
                <div class="box_title-right-down" style="background-color: {{date.color}};"></div>
                {{if date.date}}
                <div class="box_title-left" style="background-color: {{date.color}};">
                    <p name="pvis">{{date.date}}</p>
                </div>
                {{/if}}
                {{if date?.update_num > 1}}
                <div class="box_title-right">
                    <p name="pvis">Updated × {{date.update_num}}</p>
                </div>
                {{/if}}
            </div>
            {{/each}}
        </div>
        <div class="song_box">
            {{each time_line date}}
            {{each date.song song}}
            <div class="abox">
                <div class="imgbox">
                    <img src="{{song.illustration}}" alt="{{song.song}}">
                </div>
                <div class="infobox">
                    <div class="namebox">
                        {{if song.Rating}}
                        <div class="new-box">
                            <img src="{{_res_path}}html/otherimg/{{song.Rating}}.png" alt="{{song.Rating}}">
                        </div>
                        {{/if}}
                        <div class="songsname">
                            <p name="pvis">{{song.song}}</p>
                        </div>
                    </div>
                    <div class="songsinfo">
                        <div class="rank">
                            <p>{{song.rank}}</p>
                        </div>
                        <div class="score">
                            <p>{{song.score_new}}</p>
                        </div>
                        <div class="acc">
                            <p style="font-size: 30px;">{{song.acc_new - song.acc_new % 1}}</p>
                            <p style="font-size: 15px;margin-bottom: 5px">.{{((song.acc_new %
                                1).toFixed(4)).replace('0.','')}}%</p>
                        </div>
                        {{if song.rks_new}}
                        <div class="rks">
                            <p>{{song.rks_new.toFixed(4)}}</p>
                        </div>
                        {{/if}}
                    </div>
                </div>
            </div>
            {{/each}}
            {{/each}}
        </div>
        {{/each}}
    </div>
    {{else}}
    <div class="Nosignal">
        <div class="border_corner border_corner_left_top"></div>
        <div class="border_corner border_corner_right_top"></div>
        <div class="border_corner border_corner_left_bottom"></div>
        <div class="border_corner border_corner_right_bottom"></div>
        <div class="line"></div>
        <div class="timeout">
            <p>NOT_FOUND</p>
        </div>
        <div class="client">
            <p>>>> PhigrOS Client Finding NewScore</p>
        </div>
        <div class="sqrt"></div>
    </div>
    {{/if}}
    <div class="createdbox">
        <div class="phi-plugin">
            <p>Phi-Plugin</p>
        </div>
        <div class="ver">
            <p>{{Version.ver}}</p>
        </div>
    </div>
    {{if tips}}
    <div class="tips">
        <p>Tip:{{tips}}</p>
    </div>
    {{/if}}

    <!-- 曲目名称自适应宽度 -->
    <script>
        function adjustFontSize() {
            //获取p元素
            var a = document.getElementsByName('pvis')
            for (var i = 0; i < a.length; ++i) {

                const songName = a[i]

                if (!songName) continue


                /*调整曲目名称字体大小*/
                var parentElement = songName.parentElement

                var maxFontSize = 23.5 //设置最大字体大小

                //如果字体宽度小于父元素宽度，则增大字体大小
                while (songName.scrollWidth < parentElement.offsetWidth && songName.scrollHeight < parentElement.offsetHeight) {
                    var style = window.getComputedStyle(songName, null).getPropertyValue('font-size')
                    var fontSize = parseFloat(style)

                    //检查是否已经达到最大字体大小
                    if (fontSize >= maxFontSize) {
                        break
                    }

                    songName.style.fontSize = (fontSize + 1) + "px"
                }

                // 如果字体宽度大于父元素宽度，则减小字体大小
                while (songName.scrollWidth > parentElement.offsetWidth || songName.scrollHeight > parentElement.offsetHeight) {
                    var style = window.getComputedStyle(songName, null).getPropertyValue('font-size')
                    var fontSize = parseFloat(style);
                    songName.style.fontSize = (fontSize - 1) + "px";
                }
            }
        }
        window.onload = adjustFontSize
        window.onresize = adjustFontSize
    </script>
</body>
